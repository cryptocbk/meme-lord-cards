<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Карточная Игра в Стиле Splinterlands</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome для иконок -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1117;
            color: #c9d1d9;
        }
        .card {
            @apply flex flex-col items-center p-4 bg-gray-800 rounded-lg shadow-xl m-2 border-2 border-yellow-500 transition-all duration-300;
        }
        .card:hover {
            transform: scale(1.05);
            @apply shadow-2xl;
        }
        .card.is-attacking {
            animation: attack-animation 0.5s ease-in-out;
        }
        .card.is-healing {
            animation: heal-animation 1s ease-in-out;
        }
        .card.is-damaged {
            animation: shake 0.5s ease-in-out;
        }
        @keyframes attack-animation {
            0% { transform: translateX(0) scale(1.05); }
            50% { transform: translateX(20px) scale(1.15); }
            100% { transform: translateX(0) scale(1.05); }
        }
        @keyframes heal-animation {
            0% { transform: scale(1.05); box-shadow: 0 0 10px #22c55e; }
            50% { transform: scale(1.15); box-shadow: 0 0 20px #22c55e; }
            100% { transform: scale(1.05); box-shadow: 0 0 10px #22c55e; }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
    </style>
</head>
<body class="p-6">
    <div class="flex flex-col items-center">
        <h1 class="text-4xl font-bold mb-8 text-center text-yellow-400">Карточная Игра в Стиле Splinterlands</h1>
        
        <!-- Контейнер для битвы -->
        <div id="battle-container" class="w-full max-w-6xl mt-8">
            <div class="flex justify-around items-center mb-8">
                <div class="text-center">
                    <h3 class="text-2xl font-bold mb-4">Ваша Команда</h3>
                    <div id="player-heroes" class="flex flex-wrap justify-center"></div>
                </div>
                <div class="text-center">
                    <h3 class="text-2xl font-bold mb-4">Команда Противника</h3>
                    <div id="opponent-heroes" class="flex flex-wrap justify-center"></div>
                </div>
            </div>

            <!-- Лог боя -->
            <div id="battle-log" class="bg-gray-800 p-6 rounded-lg shadow-inner max-h-96 overflow-y-auto">
                <h3 class="text-2xl font-bold mb-4 text-center text-yellow-400">Лог Боя</h3>
            </div>
            
            <div class="flex justify-center mt-8">
                <button id="next-turn-btn" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg shadow-lg transition-colors duration-200">Следующий ход</button>
                <button id="play-again-btn" class="px-6 py-2 bg-purple-600 hover:bg-purple-700 text-white font-bold rounded-lg shadow-lg transition-colors duration-200 hidden">Играть снова</button>
            </div>
        </div>
    </div>

    <script>
        // Данные героев с уже готовыми изображениями
        const heroesData = [
            {
                name: "Огненный Воин",
                element: "Огонь",
                hp: 10,
                attack: 3,
                armor: 1,
                speed: 4,
                mana: 4,
                ability: "Пылающий Удар",
                image: "https://i.imgur.com/rQ0YvV4.png"
            },
            {
                name: "Ледяной Страж",
                element: "Вода",
                hp: 12,
                attack: 2,
                armor: 2,
                speed: 2,
                mana: 5,
                ability: "Защита Льда",
                image: "https://i.imgur.com/2U9g2bX.png"
            },
            {
                name: "Лесной Друид",
                element: "Земля",
                hp: 8,
                attack: 1,
                armor: 0,
                speed: 3,
                mana: 3,
                ability: "Целебный Росток",
                image: "https://i.imgur.com/tY7gU5O.png"
            },
            {
                name: "Тёмный Рейнджер",
                element: "Тьма",
                hp: 7,
                attack: 4,
                armor: 0,
                speed: 5,
                mana: 6,
                ability: "Теневой Удар",
                image: "https://i.imgur.com/vH1rR9P.png"
            }
        ];

        let playerTeam = [];
        let opponentTeam = [];
        let turn = 0;
        let isProcessingTurn = false;
        
        const playerHeroesContainer = document.getElementById('player-heroes');
        const opponentHeroesContainer = document.getElementById('opponent-heroes');
        const battleLog = document.getElementById('battle-log');
        const nextTurnBtn = document.getElementById('next-turn-btn');
        const playAgainBtn = document.getElementById('play-again-btn');

        // Рендеринг карточки героя
        function renderHeroCard(hero, isPlayer) {
            return `
                <div class="card w-48 text-center" data-name="${hero.name}" data-is-player="${isPlayer}" data-index="${isPlayer ? playerTeam.indexOf(hero) : opponentTeam.indexOf(hero)}">
                    <h4 class="text-xl font-bold mb-2 text-yellow-300">${hero.name}</h4>
                    <img src="${hero.image}" alt="${hero.name}" class="w-full h-40 object-cover rounded mb-2">
                    <div class="flex items-center text-sm mb-1">
                        <i class="fas fa-heart text-red-500 mr-2"></i>
                        <span>Здоровье: ${hero.currentHp}/${hero.hp}</span>
                    </div>
                    <div class="flex items-center text-sm mb-1">
                        <i class="fas fa-fist-raised text-red-500 mr-2"></i>
                        <span>Атака: ${hero.attack}</span>
                    </div>
                    <div class="flex items-center text-sm mb-1">
                        <i class="fas fa-shield-alt text-gray-400 mr-2"></i>
                        <span>Защита: ${hero.armor}</span>
                    </div>
                    <div class="flex items-center text-sm mb-1">
                        <i class="fas fa-running text-blue-400 mr-2"></i>
                        <span>Скорость: ${hero.speed}</span>
                    </div>
                    <div class="flex items-center text-sm mb-1">
                        <i class="fas fa-star text-yellow-400 mr-2"></i>
                        <span>Способность: ${hero.ability}</span>
                    </div>
                    <div class="w-full h-2 bg-gray-600 rounded mt-2">
                        <div style="width: ${Math.max(0, (hero.currentHp / hero.hp) * 100)}%;" class="h-full bg-red-500 rounded transition-all duration-300"></div>
                    </div>
                </div>
            `;
        }

        // Обновление отображения команд
        function updateUI() {
            playerHeroesContainer.innerHTML = playerTeam.map(hero => renderHeroCard(hero, true)).join('');
            opponentHeroesContainer.innerHTML = opponentTeam.map(hero => renderHeroCard(hero, false)).join('');
        }

        // Анимация атаки и получения урона
        function animateAttack(attacker, defender) {
            const attackerElement = document.querySelector(`.card[data-name="${attacker.name}"][data-is-player="${playerTeam.includes(attacker)}"]`);
            const defenderElement = document.querySelector(`.card[data-name="${defender.name}"][data-is-player="${opponentTeam.includes(defender)}"]`);

            if (attackerElement) {
                attackerElement.classList.add('is-attacking');
                setTimeout(() => {
                    attackerElement.classList.remove('is-attacking');
                }, 500);
            }
            if (defenderElement) {
                defenderElement.classList.add('is-damaged');
                setTimeout(() => {
                    defenderElement.classList.remove('is-damaged');
                }, 500);
            }
        }
        
        // Анимация исцеления
        function animateHeal(healer, target) {
            const targetElement = document.querySelector(`.card[data-name="${target.name}"]`);
            if (targetElement) {
                targetElement.classList.add('is-healing');
                setTimeout(() => {
                    targetElement.classList.remove('is-healing');
                }, 1000);
            }
        }


        // Добавление сообщения в лог
        function logMessage(message, color = "text-white") {
            const p = document.createElement('p');
            p.textContent = message;
            p.classList.add(color, "mb-2");
            battleLog.appendChild(p);
            battleLog.scrollTop = battleLog.scrollHeight;
        }

        // Инициализация игры
        function initializeGame() {
            logMessage("Игра готова! Нажмите 'Следующий ход' для начала битвы!", "text-green-400");
            
            playerTeam = [...heroesData.map(h => ({ ...h, currentHp: h.hp }))];
            opponentTeam = [...heroesData.map(h => ({ ...h, currentHp: h.hp }))];
            
            updateUI();
        }

        // Логика боя
        function battleStep() {
            if (isProcessingTurn) return;
            isProcessingTurn = true;

            const allHeroes = [...playerTeam, ...opponentTeam];
            allHeroes.sort((a, b) => b.speed - a.speed);
            
            if (playerTeam.length === 0 || opponentTeam.length === 0) {
                endGame();
                return;
            }

            logMessage("--- Новый ход ---", "text-yellow-400");
            
            let battleSequence = [];

            // Собираем все действия за ход
            for (const attacker of allHeroes) {
                if (attacker.currentHp <= 0) continue; 

                const isAttackerPlayer = playerTeam.includes(attacker);
                const defenderTeam = isAttackerPlayer ? opponentTeam : playerTeam;
                
                if (defenderTeam.length === 0) continue; 
                
                const defender = defenderTeam[0]; 
                
                const damage = Math.max(0, attacker.attack - defender.armor);
                
                battleSequence.push(() => {
                    animateAttack(attacker, defender);
                    defender.currentHp -= damage;
                    logMessage(`${attacker.name} атакует ${defender.name}, нанося ${damage} урона.`);
                });
                
                switch(attacker.ability) {
                    case "Пылающий Удар":
                        if (isAttackerPlayer) {
                            const weakestOpponent = opponentTeam.reduce((weakest, current) => current.currentHp < weakest.currentHp ? current : weakest, opponentTeam[0]);
                            if (weakestOpponent && weakestOpponent !== defender) {
                                battleSequence.push(() => {
                                    weakestOpponent.currentHp -= 1;
                                    logMessage(`${attacker.name} использует 'Пылающий Удар' на ${weakestOpponent.name}, нанося 1 дополнительный урон.`, "text-orange-300");
                                });
                            }
                        }
                        break;
                    case "Защита Льда":
                        battleSequence.push(() => {
                            attacker.armor += 1;
                            logMessage(`${attacker.name} использует 'Защиту Льда', его защита временно повышается.`, "text-blue-300");
                        });
                        break;
                    case "Целебный Росток":
                        if (isAttackerPlayer) {
                            const weakestAlly = playerTeam.filter(h => h.currentHp > 0).reduce((weakest, current) => current.currentHp < weakest.currentHp ? current : weakest, playerTeam[0]);
                            if (weakestAlly) {
                                battleSequence.push(() => {
                                    animateHeal(attacker, weakestAlly);
                                    weakestAlly.currentHp = Math.min(weakestAlly.hp, weakestAlly.currentHp + 2);
                                    logMessage(`${attacker.name} использует 'Целебный Росток', исцеляя ${weakestAlly.name} на 2 HP.`, "text-green-300");
                                });
                            }
                        }
                        break;
                    case "Теневой Удар":
                        battleSequence.push(() => {
                            defender.currentHp -= 2; 
                            logMessage(`${attacker.name} использует 'Теневой Удар', нанося 2 дополнительный урон.`, "text-gray-400");
                        });
                        break;
                }
            }

            // Выполняем действия с задержкой, чтобы увидеть анимацию
            let actionIndex = 0;
            const executeAction = () => {
                if (actionIndex < battleSequence.length) {
                    battleSequence[actionIndex]();
                    updateUI();
                    actionIndex++;
                    setTimeout(executeAction, 1000); // Задержка между действиями
                } else {
                    // Удаляем мертвых героев
                    playerTeam = playerTeam.filter(hero => hero.currentHp > 0);
                    opponentTeam = opponentTeam.filter(hero => hero.currentHp > 0);
                    updateUI();
                    isProcessingTurn = false;
                    if (playerTeam.length === 0 || opponentTeam.length === 0) {
                        endGame();
                    }
                }
            };
            executeAction();
        }

        // Завершение игры
        function endGame() {
            nextTurnBtn.classList.add('hidden');
            playAgainBtn.classList.remove('hidden');
            
            if (playerTeam.length > 0 && opponentTeam.length === 0) {
                logMessage("Поздравляем! Вы победили!", "text-green-500");
            } else if (playerTeam.length === 0 && opponentTeam.length > 0) {
                logMessage("Вы проиграли. Попробуйте снова!", "text-red-500");
            } else {
                logMessage("Битва закончилась ничьей!", "text-blue-500");
            }
        }

        // Обработчики событий
        nextTurnBtn.addEventListener('click', battleStep);

        playAgainBtn.addEventListener('click', () => {
            playAgainBtn.classList.add('hidden');
            nextTurnBtn.classList.remove('hidden');
            battleLog.innerHTML = `<h3 class="text-2xl font-bold mb-4 text-center text-yellow-400">Лог Боя</h3>`;
            initializeGame();
        });

        window.onload = initializeGame;
    </script>
</body>
</html>
