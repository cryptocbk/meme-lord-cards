<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Meme Lord Cards</title>
  <meta name="description" content="Turn any photo into a shareable Meme Lord card with AI‑generated funny quotes. 100% client-side." />
  <meta name="theme-color" content="#0b0f16" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Bangers&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b0f16; --card:#111827; --text:#e5e7eb; --muted:#9ca3af; --accent:#22c55e; --ring:#22c55e55;
      --radius:20px; --shadow:0 10px 30px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    body{margin:0;background:radial-gradient(1200px 800px at 70% -10%, #1f2937 0%, #0b0f16 40%), var(--bg);color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Apple Color Emoji,Arial,sans-serif;}
    header{position:sticky;top:0;backdrop-filter:saturate(1.2) blur(12px);background:linear-gradient(#0b0f16cc,#0b0f1600);z-index:10;
      animation:slideInDown 0.8s ease-out;}
    .wrap{max-width:1060px;margin:0 auto;padding:16px}
    .nav{display:flex;align-items:center;gap:12px}
    .logo{font-weight:800;letter-spacing:.5px;
      animation:glow 3s ease-in-out infinite alternate;}
    .badge{font-size:12px;color:#a7f3d0;background:#064e3b;border:1px solid #065f46;border-radius:999px;padding:4px 8px;
      animation:fadeInRight 1s ease-out 0.5s both;}

    /* ANIMATIONS */
    @keyframes slideInDown {
      from { transform: translateY(-100%); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    @keyframes slideInLeft {
      from { transform: translateX(-100px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    @keyframes slideInRight {
      from { transform: translateX(100px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    @keyframes fadeInUp {
      from { transform: translateY(50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    @keyframes fadeInRight {
      from { transform: translateX(30px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    @keyframes glow {
      from { text-shadow: 0 0 10px rgba(34, 197, 94, 0.3); }
      to { text-shadow: 0 0 20px rgba(34, 197, 94, 0.6), 0 0 30px rgba(34, 197, 94, 0.4); }
    }
    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
      40% { transform: translateY(-3px); }
      60% { transform: translateY(-1px); }
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    @keyframes cardFlip {
      0% { transform: perspective(600px) rotateY(0deg); }
      50% { transform: perspective(600px) rotateY(180deg); }
      100% { transform: perspective(600px) rotateY(0deg); }
    }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-2px); }
      75% { transform: translateX(2px); }
    }

    .grid{display:grid;grid-template-columns:1fr;gap:16px;margin-top:12px}
    @media(min-width:980px){.grid{grid-template-columns:420px 1fr}}

    .panel{background:linear-gradient(180deg,#141a24,#0f1622);border:1px solid #1f2937;border-radius:var(--radius);padding:14px;box-shadow:var(--shadow);
      transition:all 0.3s ease;}
    .panel:nth-child(1) { animation:slideInLeft 1s ease-out 0.2s both; }
    .panel:nth-child(2) { animation:slideInRight 1s ease-out 0.4s both; }
    .panel:nth-child(3) { animation:fadeInUp 1s ease-out 0.6s both; }
    .panel:hover{transform:translateY(-2px);box-shadow:0 15px 40px rgba(0,0,0,.4);}
    .panel h2{margin:0 0 10px 0;font-size:18px}
    .muted{color:var(--muted);font-size:13px}

    .upload{border:2px dashed #374151;border-radius:16px;padding:16px;text-align:center;transition:all .3s ease}
    .upload.drag{border-color:var(--accent);box-shadow:0 0 0 6px var(--ring);animation:pulse 0.6s ease;}
    .upload input{display:none}
    .upload .btn{display:inline-flex;gap:8px;align-items:center;margin-top:10px}

    .row{display:flex;gap:10px;flex-wrap:wrap}
    .field{flex:1;min-width:160px}
    label{display:block;font-size:12px;color:var(--muted);margin:6px 0}
    select,input[type="text"],input[type="number"],input[type="password"]{width:100%;padding:10px 12px;border-radius:12px;border:1px solid #374151;background:#0b1220;color:var(--text);
      transition:all 0.2s ease;}
    select:focus,input:focus{border-color:var(--accent);box-shadow:0 0 0 3px var(--ring);outline:none;}

    .btn{background:#10b981;color:#03211a;border:none;padding:10px 14px;border-radius:12px;font-weight:600;cursor:pointer;box-shadow:0 6px 16px rgba(16,185,129,.25);transition:all .2s ease}
    .btn:hover{transform:translateY(-2px);box-shadow:0 8px 20px rgba(16,185,129,.35);animation:bounce 0.6s ease;}
    .btn:active{transform:translateY(0);animation:none;}
    .btn.secondary{background:#1f2937;color:#e5e7eb;border:1px solid #374151;box-shadow:none}
    .btn.secondary:hover{background:#374151;transform:translateY(-1px);}
    .btn.ghost{background:transparent;color:var(--text);border:1px dashed #334155}
    .btn.ghost:hover{border-color:var(--accent);color:var(--accent);}
    .btn:disabled{opacity:0.6;cursor:not-allowed;transform:none;animation:none;}

    .tools{display:flex;gap:8px;flex-wrap:wrap}

    canvas{width:100%;max-width:520px;border-radius:16px;border:1px solid #1f2937;background:#0b1220;
      transition:all 0.3s ease;cursor:pointer;}
    canvas:hover{transform:scale(1.02);box-shadow:0 10px 30px rgba(0,0,0,.5);}
    canvas.flipping{animation:cardFlip 1s ease-in-out;}

    .gallery{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px}
    .thumb{background:#0b1220;border:1px solid #1f2937;border-radius:14px;padding:10px;
      transition:all 0.3s ease;animation:fadeInUp 0.6s ease-out;}
    .thumb:hover{transform:translateY(-5px);border-color:var(--accent);}
    .thumb img{width:100%;border-radius:10px}

    footer{opacity:.8;font-size:12px;padding:28px 0;text-align:center;
      animation:fadeInUp 1s ease-out 1s both;}
    a{color:#86efac}

    .theme-chip{display:inline-flex;align-items:center;gap:8px;border:1px solid #334155;padding:8px 10px;border-radius:999px;cursor:pointer;
      transition:all 0.2s ease;}
    .theme-chip input{display:none}
    .theme-chip.active{border-color:#10b981;box-shadow:0 0 0 4px var(--ring);animation:pulse 0.4s ease;}
    .theme-chip:hover{transform:scale(1.05);border-color:#10b981;}
    .chips{display:flex;flex-wrap:wrap;gap:10px}
    .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;background:#0b1220;border:1px solid #334155;border-radius:6px;padding:2px 6px;color:#e5e7eb}

    /* Quote Category Buttons */
    .quote-categories{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0;}
    .category-btn{background:transparent;border:1px solid #334155;color:#94a3b8;padding:6px 12px;border-radius:20px;font-size:12px;cursor:pointer;
      transition:all 0.2s ease;}
    .category-btn:hover{border-color:var(--accent);color:var(--accent);transform:scale(1.05);}
    .category-btn.active{background:var(--accent);color:#0b0f16;border-color:var(--accent);}

    /* Stats animation */
    .stat-bar{animation:fillBar 2s ease-out 0.5s both;}
    @keyframes fillBar {
      from { width: 0; }
      to { width: var(--fill-width); }
    }

    /* Notification */
    .notification{position:fixed;top:20px;right:20px;background:var(--accent);color:#0b0f16;padding:12px 16px;border-radius:12px;
      font-weight:600;z-index:1000;transform:translateX(100%);transition:transform 0.3s ease;}
    .notification.show{transform:translateX(0);}
  </style>
</head>
<body>
  <header>
    <div class="wrap nav">
      <div class="logo" style="font-family:Bangers,Inter,sans-serif;font-size:22px;display:flex;align-items:center;gap:10px">
        🤖 Meme Lord Cards
      </div>
      <span class="badge">100% client-side • free</span>
    </div>
  </header>

  <main class="wrap grid">
    <!-- LEFT: controls -->
    <section class="panel">
      <h2>1) Upload Your Photo</h2>
      <div id="drop" class="upload">
        <div>Drag and drop your image here or
          <label for="file" class="btn secondary">choose a file</label>
        </div>
        <div class="muted">JPG/PNG up to ~10MB. Processing is done on your device.</div>
        <input id="file" type="file" accept="image/*" />
      </div>

      <h2 style="margin-top:18px">2) Card Settings</h2>
      <div class="row">
        <div class="field">
          <label>Display Name</label>
          <input id="name" type="text" placeholder="Meme Lord" />
        </div>
        <div class="field">
          <label>Rarity</label>
          <select id="rarity">
            <option>Common</option>
            <option>Rare</option>
            <option>Epic</option>
            <option>Legendary</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label>Theme</label>
          <div class="chips" id="themes"></div>
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label>Quote Category</label>
          <div class="quote-categories" id="quoteCategories"></div>
        </div>
        <div class="field">
          <label>Funny Quote</label>
          <div class="tools">
            <button id="quoteBtn" class="btn" type="button">🎭 Randomize</button>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="field"><label>Meme Level</label><input id="lvl" type="number" min="0" max="999" value="87"/></div>
        <div class="field"><label>Viral %</label><input id="vir" type="number" min="0" max="100" value="69"/></div>
        <div class="field"><label>Chaos</label><input id="chs" type="number" min="0" max="100" value="42"/></div>
      </div>
      <div class="tools" style="margin-top:12px">
        <button id="randomBtn" class="btn" type="button">🎲 Randomize Stats</button>
        <button id="genBtn" class="btn" type="button">⚡ Create Card</button>
        <button id="dlBtn" class="btn secondary" type="button">⬇️ Download PNG</button>
        <button id="shareBtn" class="btn ghost" type="button">📤 Share</button>
      </div>

      <p class="muted" style="margin-top:10px">Privacy: Your image never leaves your device. All processing is local.</p>
    </section>

    <!-- RIGHT: preview -->
    <section class="panel">
      <h2>Preview</h2>
      <canvas id="card" width="750" height="1050" aria-label="Card Preview"></canvas>
      <div class="muted" style="margin-top:8px;text-align:center;font-size:11px;">💡 Click the card to generate a new random quote</div>
    </section>

    <section class="panel" style="grid-column:1/-1">
      <h2>My Gallery</h2>
      <div id="gallery" class="gallery"></div>
      <div id="loader" style="text-align:center;padding:20px;display:none;">
        Loading gallery...
      </div>
    </section>
  </main>

  <footer class="wrap">
    Made for fun ❤️ — host this file on GitHub Pages. No trackers, no servers.
  </footer>

  <div id="notification" class="notification"></div>

<script type="module">
  // Import necessary Firebase modules
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
  import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
  import { getFirestore, collection, addDoc, onSnapshot, doc, deleteDoc, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

  (async function(){
    const $ = (s) => document.querySelector(s);
    const drop = $('#drop');
    const file = $('#file');
    const nameInput = $('#name');
    const rarity = $('#rarity');
    const lvl = $('#lvl');
    const vir = $('#vir');
    const chs = $('#chs');
    const card = $('#card');
    const ctx = card.getContext('2d');
    const dlBtn = $('#dlBtn');
    const genBtn = $('#genBtn');
    const randomBtn = $('#randomBtn');
    const quoteBtn = $('#quoteBtn');
    const shareBtn = $('#shareBtn');
    const gallery = $('#gallery');
    const loader = $('#loader');
    const themesWrap = $('#themes');
    const quoteCategoriesWrap = $('#quoteCategories');
    const notification = $('#notification');

    let db, auth, userId;

    // Initialize Firebase
    try {
      setLogLevel('debug'); // Enable logging for debugging
      const firebaseConfig = JSON.parse(__firebase_config);
      const app = initializeApp(firebaseConfig);
      auth = getAuth(app);
      db = getFirestore(app);

      // Authenticate user
      if (typeof __initial_auth_token !== 'undefined') {
        await signInWithCustomToken(auth, __initial_auth_token);
      } else {
        await signInAnonymously(auth);
      }
    } catch(e) {
      console.error("Firebase initialization error:", e);
      showNotification('Error loading database. Gallery will not work.');
    }

    // Auth state listener
    onAuthStateChanged(auth, (user) => {
      if (user) {
        userId = user.uid;
        console.log("User authenticated:", userId);
        loadGallery();
      } else {
        console.log("User not authenticated.");
        userId = 'anon_' + crypto.randomUUID(); // Fallback for anonymous user
      }
    });

    // ---------- THEMES ----------
    const THEMES = [
      { id:'neon', name:'Neon Vapor', bg:['#0f172a','#0b1220'], glow:'#22d3ee', primary:'#22d3ee', accent:'#f472b6'},
      { id:'gold', name:'Royal Gold', bg:['#1b1b1b','#101010'], glow:'#f59e0b', primary:'#fbbf24', accent:'#fde68a'},
      { id:'matrix', name:'Matrix', bg:['#00140a','#000d08'], glow:'#22c55e', primary:'#10b981', accent:'#34d399'},
      { id:'retro', name:'Retro Pop', bg:['#2b1b47','#1a1030'], glow:'#a78bfa', primary:'#f472b6', accent:'#fb7185'},
      { id:'steel', name:'Steel', bg:['#0a0a0a','#151515'], glow:'#60a5fa', primary:'#93c5fd', accent:'#e5e7eb'}
    ];

    // ---------- QUOTE CATEGORIES ----------
    const QUOTE_CATEGORIES = {
      funny: {
        name: '😂 Funny',
        quotes: [
          "I'm fueled by caffeine and chaos.", "My brain has too many tabs open.", "I'm not lazy, I'm in energy-saving mode.",
          "My life is a constant quest for my keys.", "My only superpower is procrastination.", "Certified professional napper.",
          "I run on a strict diet of memes and instant noodles.", "My code works, but I have no idea why.", "The WiFi is down, the world is ending.",
          "I'm an expert in 'just one more episode'.", "I'm not weird, I'm a limited edition.", "My life is a comedy of errors.",
          "I survived Y2K, still debugging.", "I speak fluent sarcasm and emoji.", "My biggest fear is running out of snacks.",
          "Is it a bug or a feature? Depends on the deadline.", "I'm a human-sized bug magnet.", "My life is a constant git revert.",
          "My computer knows more about my feelings than I do.", "I'm not antisocial, I'm just selectively social.",
          "The only thing more complex than my code is my mood.", "My code is like a box of chocolates; you never know what you're gonna get.",
          "I don't have a messy desk, I have a filing system.", "My therapist said I should express my emotions, so I wrote this code.",
          "I'm not a morning person, I'm a 'let me scroll for five minutes' person.", "I'm a night owl, but my schedule says I'm a morning pigeon.",
          "I don't need a therapist, I have a dog and a bottle of wine.", "I'm not a coffee addict, I'm just a coffee enthusiast.",
          "I'm not a procrastinator, I'm a deadline enthusiast.", "I'm a meme lord, but my bank account says I'm a meme peasant.",
          "I'm not a people person, I'm a cat person.", "My life is a constant battle between what I want and what I need.",
          "I'm not a perfectionist, I just have very high standards.", "I'm not a good dancer, but I can make a mean cup of tea.",
          "I'm not a bad cook, I'm just a bad chef.", "I'm not a bad driver, I'm just a very creative one.",
          "I'm not a bad friend, I'm just a very busy one.", "I'm not a bad lover, I'm just a very... complicated one.",
          "I'm not a bad person, I just have a very... interesting personality.", "I'm not a bad singer, I'm just a very... unique one.",
          "I'm not a bad artist, I'm just a very... abstract one.", "I'm not a bad writer, I'm just a very... avant-garde one.",
          "I'm not a bad programmer, I'm just a very... innovative one.", "I'm not a bad student, I'm just a very... creative one.",
          "I'm not a bad teacher, I'm just a very... unconventional one.", "I'm not a bad leader, I'm just a very... democratic one.",
          "I'm not a bad employee, I'm just a very... independent one.", "I'm not a bad boss, I'm just a very... relaxed one.",
          "I'm not a bad friend, I'm just a very... loyal one.", "I'm not a bad lover, I'm just a very... passionate one.",
          "I'm not a bad person, I'm just a very... honest one.", "I'm not a bad singer, I'm just a very... soulful one.",
          "I'm not a bad artist, I'm just a very... expressive one.", "I'm not a bad writer, I'm just a very... poetic one.",
          "I'm not a bad programmer, I'm just a very... thoughtful one.", "I'm not a bad student, I'm just a very... curious one.",
          "I'm not a bad teacher, I'm just a very... inspiring one.", "I'm not a bad leader, I'm just a very... visionary one.",
          "I'm not a bad employee, I'm just a very... dedicated one.", "I'm not a bad boss, I'm just a very... supportive one.",
          "I'm not a bad friend, I'm just a very... dependable one.", "I'm not a bad lover, I'm just a very... devoted one.",
          "I'm not a bad person, I'm just a very... kind one.", "I'm not a bad singer, I'm just a very... authentic one.",
          "I'm not a bad artist, I'm just a very... unique one.", "I'm not a bad writer, I'm just a very... creative one.",
          "I'm not a bad programmer, I'm just a very... innovative one.", "I'm not a bad student, I'm just a very... creative one.",
          "I'm not a bad teacher, I'm just a very... unconventional one.", "I'm not a bad leader, I'm just a very... democratic one.",
          "I'm not a bad employee, I'm just a very... independent one.", "I'm not a bad boss, I'm just a very... relaxed one.",
          "I'm not a bad friend, I'm just a very... loyal one.", "I'm not a bad lover, I'm just a very... passionate one.",
          "I'm not a bad person, I'm just a very... honest one.", "I'm not a bad singer, I'm just a very... soulful one.",
          "I'm not a bad artist, I'm just a very... expressive one.", "I'm not a bad writer, I'm just a very... poetic one.",
          "I'm not a bad programmer, I'm just a very... thoughtful one.", "I'm not a bad student, I'm just a very... curious one.",
          "I'm not a bad teacher, I'm just a very... inspiring one.", "I'm not a bad leader, I'm just a very... visionary one.",
          "I'm not a bad employee, I'm just a very... dedicated one.", "I'm not a bad boss, I'm just a very... supportive one.",
          "I'm not a bad friend, I'm just a very... dependable one.", "I'm not a bad lover, I'm just a very... devoted one.",
          "I'm not a bad person, I'm just a very... kind one.", "I'm not a bad singer, I'm just a very... authentic one.",
          "I'm not a bad artist, I'm just a very... unique one.", "I'm not a bad writer, I'm just a very... creative one."
        ]
      },
      sarcastic: {
        name: '😏 Sarcastic',
        quotes: [
          "Oh, great, another meeting.", "Adulting: 0 stars, do not recommend.", "I'm not arguing, I'm just explaining why I'm right.",
          "Of course, let's add another deadline.", "Am I working hard or hardly working? Yes.", "My code works, don't touch it.",
          "Monday again? How original.", "Asking for a friend (it's me).", "Fine, I'll do it myself.",
          "Surprise! It still doesn't work.", "My brain is not a storage unit for information.",
          "I'm not lazy, I'm just very energy-efficient.", "Thanks for the reminder, I already forgot.",
          "I'm not mad, I'm just allergic to stupidity.", "Sure, I believe you... and in Santa Claus.",
          "My life is a continuous comedy, except I'm not laughing.", "When life gives you lemons, pretend they're grapes.",
          "I'm not perfect, but at least I'm not you.", "My brain: 'Something went wrong, but I don't know what.'",
          "Just want someone to tell me I'm needed.", "My life is a constant flow of memes.",
          "I'm not smart, I'm just good at pretending.", "My life is a movie nobody watches.",
          "Just want someone to say I'm awesome.", "My life is a game with no rules.",
          "I can't cook, but I can reheat.", "My life is a comedy of errors.",
          "Just want someone to say I'm needed.", "My life is an endless quest.",
          "I'm not mad, I'm just tired.", "My life is pure humor.",
          "Just want someone to say I'm beautiful.", "My life is madness.",
          "I'm not lazy, I just don't like to work.", "My life is a meme.",
          "Just want someone to say I'm a genius.", "My life is a TV show.",
          "I can't do anything, but I can bring coffee.", "My life is a movie.",
          "Just want someone to say I'm cool.", "My life is a game.",
          "I'm not mad, I'm just hungry.", "My life is pure chaos.",
          "Just want someone to say I'm awesome.", "My life is humor.",
          "I'm not procrastinating, I'm just waiting.", "My life is an endless quest.",
          "Just want someone to say I'm beautiful.", "My life is madness.",
          "I can't do anything, but I can bring coffee.", "My life is a movie.",
          "Just want someone to say I'm needed.", "My life is a TV show.",
          "I'm not mad, I'm just tired.", "My life is pure humor.",
          "Just want someone to say I'm a genius.", "My life is a game.",
          "I can't do anything, but I can bring coffee.", "My life is a movie.",
          "Just want someone to say I'm cool.", "My life is a comedy.",
          "I'm not mad, I'm just hungry.", "My life is chaos.",
          "Just want someone to say I'm awesome.", "My life is a meme.",
          "I'm not procrastinating, I'm just waiting.", "My life is an endless quest.",
          "Just want someone to say I'm beautiful.", "My life is madness.",
          "I can't do anything, but I can bring coffee.", "My life is a movie.",
          "Just want someone to say I'm needed.", "My life is a TV show.",
          "I'm not mad, I'm just tired.", "My life is pure humor.",
          "Just want someone to say I'm a genius.", "My life is a game.",
          "I can't do anything, but I can bring coffee.", "My life is a movie.",
          "Just want someone to say I'm cool.", "My life is a comedy.",
          "I'm not mad, I'm just hungry.", "My life is chaos.",
          "Just want someone to say I'm awesome.", "My life is a meme.",
          "I'm not procrastinating, I'm just waiting.", "My life is an endless quest.",
          "Just want someone to say I'm beautiful.", "My life is madness.",
          "I can't do anything, but I can bring coffee.", "My life is a movie.",
          "Just want someone to say I'm needed.", "My life is a TV show.",
          "I'm not mad, I'm just tired.", "My life is pure humor.",
          "Just want someone to say I'm a genius.", "My life is a game.",
          "I can't do anything, but I can bring coffee.", "My life is a movie.",
          "Just want someone to say I'm cool.", "My life is a comedy.",
          "I'm not mad, I'm just hungry.", "My life is chaos.",
          "Just want someone to say I'm awesome.", "My life is a meme."
        ]
      },
      motivational: {
        name: '💪 Motivational',
        quotes: [
          "Fixing the world, one bug at a time.", "Today's code is tomorrow's legacy.", "Turning coffee into code since forever.",
          "Keep moving forward, git happens.", "Compile your dreams into reality.", "Every bug is an opportunity to learn.",
          "Code with passion, deploy with confidence.", "The best time to code was yesterday.", "Do it, do it better.",
          "Launch and then improve.", "Believe in your code, even if it doesn't work.", "Every deadline is a new opportunity.",
          "First it works, then it's beautiful.", "Be like CSS - flexible and adaptive.",
          "Code is not just text, it's art.", "Mistakes are lessons, not failures.",
          "There is always time for one more refactoring.", "Your main goal is not to break production.",
          "Optimize your life, not just your code.", "Don't give up, someone needs your code.",
          "Be patient, your code will work eventually.", "Make your code understandable for your future self.",
          "Programming is magic, and you are a magician.", "Don't be afraid to make mistakes, be afraid not to learn.",
          "Code like no one is watching.", "You can do anything you can imagine.",
          "The most important thing is not the result, but the process.", "Your ideas are future code.",
          "Don't forget to take breaks, they are as important as code.", "You are the best debugger for your code.",
          "Just keep writing, and it will all work out.", "Your code is your legacy.",
          "Don't be afraid to experiment.", "Your work is not just code.",
          "Be creative, be unique.", "Your code is your mirror.",
          "Don't be afraid of mistakes, they teach.", "Your code is your creation.",
          "Be persistent, and you will succeed.", "Your code is your voice.",
          "Don't forget your goals.", "Your code is your path.",
          "Be optimistic, and it will all work out.", "Your code is your tool.",
          "Don't be afraid of the new, it opens doors.", "Your code is your world.",
          "Be yourself, and it will all work out.", "Your code is your strength.",
          "Don't forget your dreams.", "Your code is your story.",
          "Be ready for change.", "Your code is your future.",
          "Don't be afraid to take risks.", "Your code is your life.",
          "Be open to new ideas.", "Your code is your mind.",
          "Don't forget your possibilities.", "Your code is your talent.",
          "Be confident in yourself.", "Your code is your wisdom.",
          "Don't be afraid of criticism, it helps.", "Your code is your soul.",
          "Be purposeful.", "Your code is your inspiration.",
          "Don't forget your talents.", "Your code is your passion.",
          "Be grateful for everything.", "Your code is your gift.",
          "Don't be afraid to ask for help.", "Your code is your wealth.",
          "Be the best version of yourself.", "Your code is your happiness.",
          "Don't forget about your health.", "Your code is your art.",
          "Be aware of events.", "Your code is your greatness.",
          "Don't be afraid of change.", "Your code is your poetry.",
          "Be optimistic.", "Your code is your logic.",
          "Don't forget your friends.", "Your code is your team.",
          "Be happy.", "Your code is your life.",
          "Don't forget your goals.", "Your code is your path.",
          "Be confident in yourself.", "Your code is your tool.",
          "Don't be afraid of the new.", "Your code is your world.",
          "Be yourself.", "Your code is your strength.",
          "Don't forget your dreams.", "Your code is your story.",
          "Be ready for change.", "Your code is your future.",
          "Don't be afraid to take risks.", "Your code is your life.",
          "Be open to new ideas.", "Your code is your mind.",
          "Don't forget your possibilities.", "Your code is your talent.",
          "Be confident in yourself.", "Your code is your wisdom.",
          "Don't be afraid of criticism.", "Your code is your soul.",
          "Be purposeful.", "Your code is your inspiration.",
          "Don't forget your talents.", "Your code is your passion.",
          "Be grateful for everything.", "Your code is your gift.",
          "Don't be afraid to ask for help.", "Your code is your wealth.",
          "Be the best version of yourself.", "Your code is your happiness."
        ]
      },
      philosophical: {
        name: '🤔 Philosophical',
        quotes: [
          "In a world of zeros and ones, be a two.", "Life is like code: full of unexpected bugs.", "We are all functions in the code of the universe.",
          "To err is human; to truly mess up, you need a computer.", "The real treasure is the bugs we fixed along the way.", "Are we living or just executing?",
          "What is reality, but a collection of persistent data?", "In the end, we are all just data.",
          "Code is poetry in logic.", "The universe is just a big algorithm.",
          "The meaning of life is not to find answers, but to ask the right questions.",
          "We seek the truth, but we only find errors.", "Life is an endless loop.",
          "Freedom is not the absence of rules, but the ability to choose them.",
          "We are born to die, but we live to leave a mark.",
          "What if everything we know is just an illusion?",
          "We are not what we do, but what we choose.",
          "Life is like a game: you can win, but you can't lose.",
          "Thoughts are the invisible code that shapes our reality.",
          "Happiness is not a goal, but a path.", "We live in a world that we created ourselves.",
          "What if our world is just a simulation?", "We are what we do.",
          "Life is like a book: you can reread, but you can't change.",
          "We are not what we see, but what we feel.",
          "Life is like a river: it flows, but it doesn't return.",
          "We are not what we have, but what we give.",
          "Life is like a garden: you can plant, but you can't control.",
          "We are not what we say, but what we do.",
          "Life is like a game: you can lose, but you can't give up.",
          "We are not what we know, but what we love.",
          "Life is like a dance: you can move, but you can't stop.",
          "We are not what we think, but what we feel.",
          "Life is like a dream: you can wake up, but you can't go back.",
          "We are not what we see, but what we seek.",
          "Life is like a mirror: you see what you are.",
          "We are not what we have, but what we create.",
          "Life is like music: you can listen, but you can't control.",
          "We are not what we say, but what we do.",
          "Life is like a game: you can lose, but you can't give up.",
          "We are not what we know, but what we love.",
          "Life is like a dance: you can move, but you can't stop.",
          "We are not what we think, but what we feel.",
          "Life is like a dream: you can wake up, but you can't go back.",
          "We are not what we see, but what we seek.",
          "Life is like a mirror: you see what you are.",
          "We are not what we have, but what we create.",
          "Life is like music: you can listen, but you can't control.",
          "We are not what we say, but what we do.",
          "Life is like a game: you can lose, but you can't give up.",
          "We are not what we know, but what we love.",
          "Life is like a dance: you can move, but you can't stop.",
          "We are not what we think, but what we feel.",
          "Life is like a dream: you can wake up, but you can't go back.",
          "We are not what we see, but what we seek.",
          "Life is like a mirror: you see what you are.",
          "We are not what we have, but what we create.",
          "Life is like music: you can listen, but you can't control.",
          "We are not what we say, but what we do.",
          "Life is like a game: you can lose, but you can't give up.",
          "We are not what we know, but what we love.",
          "Life is like a dance: you can move, but you can't stop.",
          "We are not what we think, but what we feel.",
          "Life is like a dream: you can wake up, but you can't go back.",
          "We are not what we see, but what we seek.",
          "Life is like a mirror: you see what you are.",
          "We are not what we have, but what we create.",
          "Life is like music: you can listen, but you can't control."
        ]
      },
      absurd: {
        name: '🤪 Absurd',
        quotes: [
          "My rubber ducky debugs better than most people.", "Coding in Comic Sans for maximum chaos.",
          "Stack Overflow is my second brain.", "I name my variables after my pets.", "Git commit -m 'YOLO'",
          "Coding with oven mitts for an extra challenge.", "My code is self-documenting (spoiler: it's not).",
          "Debugging with aggressive comments.", "I'm fueled by pure confusion and luck.",
          "Error 404: Motivation not found.", "My cat says my code sucks.", "I talk to my computer.",
          "I'm a hacker, but only for sleep.", "My code is like art, only nobody understands it.",
          "I'm a master of creating problems, not solving them.", "My brain is like a junk drawer of ideas.",
          "I'm not an idiot, I'm just... special.", "My code is like wine, it gets worse with age.",
          "I'm not procrastinating, I'm just waiting for the code to write itself.", "I'm the main character of my own game.",
          "My cat is my only friend.", "I'm the laziest person in the world.",
          "I can't do anything, but I can bring coffee.", "My code is like a book nobody reads.",
          "I'm a human disaster.", "My code is like a riddle nobody can solve.",
          "I'm not lazy, I just don't like to work.", "My code is like a virus, it spreads.",
          "I'm the smartest person in the world.", "My code is like fire, it destroys everything in its path.",
          "I'm a genius.", "My code is like water, it goes everywhere.",
          "I can't do anything, but I can bring coffee.", "My code is like air, it's everywhere.",
          "I'm a meme lord.", "My code is like space, it's endless.",
          "I'm not lazy, I just don't like to work.", "My code is like the sun, it warms.",
          "I'm a human disaster.", "My code is like water, it cleanses.",
          "I'm the smartest person in the world.", "My code is like fire, it illuminates.",
          "I'm a genius.", "My code is like air, it fills.",
          "I can't do anything, but I can bring coffee.", "My code is like space, it fascinates.",
          "I'm a meme lord.", "My code is like the sun, it warms.",
          "I'm not lazy, I just don't like to work.", "My code is like water, it cleanses.",
          "I'm a human disaster.", "My code is like fire, it illuminates.",
          "I'm the smartest person in the world.", "My code is like air, it fills.",
          "I'm a genius.", "My code is like space, it fascinates.",
          "I can't do anything, but I can bring coffee.", "My code is like the sun, it warms.",
          "I'm a meme lord.", "My code is like water, it cleanses.",
          "I'm not lazy, I just don't like to work.", "My code is like fire, it illuminates.",
          "I'm a human disaster.", "My code is like air, it fills.",
          "I'm the smartest person in the world.", "My code is like space, it fascinates.",
          "I'm a genius.", "My code is like the sun, it warms.",
          "I can't do anything, but I can bring coffee.", "My code is like water, it cleanses.",
          "I'm a meme lord.", "My code is like fire, it illuminates.",
          "I'm not lazy, I just don't like to work.", "My code is like air, it fills.",
          "I'm a human disaster.", "My code is like space, it fascinates.",
          "I'm the smartest person in the world.", "My code is like the sun, it warms.",
          "I'm a genius.", "My code is like water, it cleanses.",
          "I can't do anything, but I can bring coffee.", "My code is like fire, it illuminates.",
          "I'm a meme lord.", "My code is like air, it fills.",
          "I'm not lazy, I just don't like to work.", "My code is like space, it fascinates."
        ]
      }
    };

    // ---------- STATE MANAGEMENT ----------
    const state = {
      image: null,
      imageBitmap: null,
      quote: 'Certified Meme Lord',
      theme: THEMES[0],
      currentCategory: 'funny'
    };

    // ---------- NOTIFICATIONS ----------
    function showNotification(message, duration = 3000) {
      notification.textContent = message;
      notification.classList.add('show');
      setTimeout(() => notification.classList.remove('show'), duration);
    }

    // ---------- UI: QUOTE CATEGORIES ----------
    function renderQuoteCategories() {
      quoteCategoriesWrap.innerHTML = '';
      Object.entries(QUOTE_CATEGORIES).forEach(([key, category]) => {
        const btn = document.createElement('button');
        btn.className = 'category-btn' + (key === state.currentCategory ? ' active' : '');
        btn.textContent = category.name;
        btn.onclick = () => {
          state.currentCategory = key;
          document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
        };
        quoteCategoriesWrap.appendChild(btn);
      });
    }

    // ---------- UI: THEMES ----------
    function renderThemeChips(){
      themesWrap.innerHTML = '';
      THEMES.forEach(t => {
        const chip = document.createElement('label');
        chip.className = 'theme-chip' + (state.theme.id===t.id ? ' active' : '');
        chip.innerHTML = `<input type="radio" name="theme" value="${t.id}"><span>🎨 ${t.name}</span>`;
        chip.onclick = () => { 
          state.theme = t; 
          drawCard(); 
          document.querySelectorAll('.theme-chip').forEach(c=>c.classList.remove('active')); 
          chip.classList.add('active');
          showNotification(`Theme changed to ${t.name}`);
        };
        themesWrap.appendChild(chip);
      });
    }

    // ---------- IMAGE HANDLING ----------
    function setDropActive(a){ 
      drop.classList.toggle('drag', !!a); 
    }
    ;['dragenter','dragover'].forEach(e=>drop.addEventListener(e, ev=>{ ev.preventDefault(); setDropActive(true); }));
    ;['dragleave','drop'].forEach(e=>drop.addEventListener(e, ev=>{ ev.preventDefault(); setDropActive(false); }));
    drop.addEventListener('drop', async (ev)=>{
      const f = ev.dataTransfer.files?.[0]; if(f) await loadFile(f);
    });
    file.addEventListener('change', async ()=>{ const f = file.files?.[0]; if(f) await loadFile(f); });

    async function loadFile(f){
      if(!f.type.startsWith('image/')) return;
      state.image = URL.createObjectURL(f);
      state.imageBitmap = await createImageBitmap(await (await fetch(state.image)).blob());
      drawCard();
      showNotification('Image uploaded successfully!');
    }

    // ---------- RANDOM VALUES ----------
    function rand(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }
    
    function randomize(){
      const names = ["Meme Lord","Chaos Gremlin","Vibe Captain","Emoji Overlord","Code Wizard","Bug Hunter","Pixel Painter","Data Sage"];
      nameInput.value = names[rand(0,names.length-1)];
      rarity.selectedIndex = rand(0,3);
      lvl.value = rand(10,999); 
      vir.value = rand(1,100); 
      chs.value = rand(0,100);
      
      const categories = Object.keys(QUOTE_CATEGORIES);
      state.currentCategory = categories[rand(0, categories.length-1)];
      renderQuoteCategories();
      
      const quotes = QUOTE_CATEGORIES[state.currentCategory].quotes;
      state.quote = quotes[rand(0,quotes.length-1)];
      
      randomBtn.style.animation = 'shake 0.5s ease';
      setTimeout(() => randomBtn.style.animation = '', 500);
      
      drawCard();
      showNotification('Stats randomized!');
    }
    
    function generateRandomQuote(category = null) {
      const targetCategory = category || state.currentCategory;
      const quotes = QUOTE_CATEGORIES[targetCategory].quotes;
      if (quotes.length === 0) {
        showNotification('No quotes in this category.');
        return;
      }
      const newQuote = quotes[rand(0, quotes.length - 1)];
      state.quote = newQuote;
      drawCard();
      showNotification(`New quote from category ${QUOTE_CATEGORIES[targetCategory].name}!`);
    }

    // ---------- DRAWING THE CARD ----------
    function roundRect(ctx, x, y, w, h, r){
      const rr = Math.min(r, w/2, h/2);
      ctx.beginPath();
      ctx.moveTo(x+rr, y);
      ctx.arcTo(x+w, y, x+w, y+h, rr);
      ctx.arcTo(x+w, y+h, x, y+h, rr);
      ctx.arcTo(x, y+h, x, y, rr);
      ctx.arcTo(x, y, x+w, y, rr);
      ctx.closePath();
    }

    function drawBackground(){
      const g = ctx.createLinearGradient(0,0,0,card.height);
      g.addColorStop(0, state.theme.bg[0]);
      g.addColorStop(1, state.theme.bg[1]);
      ctx.fillStyle = g; ctx.fillRect(0,0,card.width,card.height);
      ctx.strokeStyle = state.theme.primary; ctx.lineWidth = 8; roundRect(ctx, 18, 18, card.width-36, card.height-36, 24); ctx.stroke();
      ctx.shadowColor = state.theme.glow; ctx.shadowBlur = 24; ctx.strokeStyle = state.theme.glow; ctx.lineWidth = 2; roundRect(ctx, 26, 26, card.width-52, card.height-52, 20); ctx.stroke(); ctx.shadowBlur=0;
    }

    function drawImage(){
      const pad = 48; const frameW = card.width - pad*2; const frameH = Math.floor(card.height*0.52);
      const frameX = pad; const frameY = pad + 12;
      ctx.fillStyle = '#0b1220'; roundRect(ctx, frameX, frameY, frameW, frameH, 18); ctx.fill();
      ctx.strokeStyle = '#334151'; ctx.lineWidth = 3; roundRect(ctx, frameX, frameY, frameW, frameH, 18); ctx.stroke();
      if(!state.imageBitmap) return;
      const img = state.imageBitmap;
      const r = Math.min(frameW/img.width, frameH/img.height);
      const w = img.width*r, h = img.height*r;
      const x = frameX + (frameW - w)/2; const y = frameY + (frameH - h)/2;
      ctx.save(); ctx.beginPath(); roundRect(ctx, frameX+6, frameY+6, frameW-12, frameH-12, 14); ctx.clip();
      ctx.drawImage(img, x, y, w, h); ctx.restore();
    }

    function drawHeader(){
      const title = (nameInput.value || 'Meme Lord').toUpperCase();
      ctx.font = '800 42px Bangers, Inter, sans-serif';
      ctx.fillStyle = '#e5e7eb';
      ctx.textAlign = 'left';
      ctx.fillText(title, 48, 620);

      const pill = rarity.value || 'Common';
      const metrics = ctx.measureText(pill);
      const pw = metrics.width + 28; const ph = 36; const px = card.width - pw - 48; const py = 590;
      ctx.fillStyle = '#0b1220'; roundRect(ctx, px, py, pw, ph, 999); ctx.fill();
      ctx.strokeStyle = state.theme.primary; ctx.lineWidth = 2; roundRect(ctx, px, py, pw, ph, 999); ctx.stroke();
      ctx.fillStyle = state.theme.primary; ctx.font = '600 18px Inter, system-ui, sans-serif';
      ctx.textAlign = 'center'; ctx.fillText(pill, px+pw/2, py+24);
    }

    function wrapText(text, x, y, maxWidth, lineHeight){
      const words = text.split(' ');
      let line = '', dy = 0;
      for (let n = 0; n < words.length; n++) {
        const testLine = line + words[n] + ' ';
        const metrics = ctx.measureText(testLine);
        if (metrics.width > maxWidth && n > 0) {
          ctx.fillText(line, x, y + dy); dy += lineHeight; line = words[n] + ' ';
        } else { line = testLine; }
      }
      ctx.fillText(line.trim(), x, y + dy);
    }

    function drawStats(){
      const qx = 48, qy = 660, qw = card.width - 96, qh = 120;
      ctx.fillStyle = '#0b1220'; roundRect(ctx, qx, qy, qw, qh, 16); ctx.fill();
      ctx.strokeStyle = '#334155'; ctx.lineWidth = 2; roundRect(ctx, qx, qy, qw, qh, 16); ctx.stroke();

      ctx.font = '600 24px Inter, system-ui, sans-serif';
      ctx.fillStyle = '#e5e7eb';
      ctx.textAlign = 'center';
      wrapText(state.quote || 'Certified Meme Lord', qx + qw / 2, qy + 34, qw - 56, 30);
      ctx.textAlign = 'left';

      const sx = 48, sy = 810, sw = card.width - 96, sh = 180;
      const stats = [
        {label:'Meme Level', value: +lvl.value||0},
        {label:'Viral', value: +vir.value||0},
        {label:'Chaos', value: +chs.value||0}
      ];
      const barH = 26; let y = sy;
      stats.forEach(st => {
        ctx.save();
        ctx.font = '600 22px Inter, system-ui, sans-serif';
        ctx.fillStyle = '#cbd5e1'; 
        ctx.textAlign = 'center';
        ctx.fillText(st.label, sx + sw / 2, y+22);
        ctx.restore();

        const w = sw; const bx = sx; const by = y+24;
        ctx.fillStyle = '#111827'; roundRect(ctx, bx, by, w, barH, 10); ctx.fill();
        ctx.strokeStyle = '#334155'; ctx.lineWidth = 2; roundRect(ctx, bx, by, w, barH, 10); ctx.stroke();
        const perc = Math.max(0, Math.min(100, st.value)) / 100;
        const fw = Math.max(8, Math.floor(w*perc));
        const grad = ctx.createLinearGradient(bx, by, bx+fw, by);
        grad.addColorStop(0, state.theme.primary);
        grad.addColorStop(1, state.theme.accent);
        ctx.fillStyle = grad; roundRect(ctx, bx, by, fw, barH, 10); ctx.fill();
        y += 60;
      });

      ctx.font = '600 14px Inter, system-ui, sans-serif';
      ctx.fillStyle = '#94a3b8';
      ctx.textAlign = 'right';
      ctx.fillText('meme.lord – generated offline', card.width-48, card.height-36);
      ctx.textAlign = 'left';
    }

    function drawCard(){
      ctx.clearRect(0,0,card.width,card.height);
      drawBackground();
      drawImage();
      drawHeader();
      drawStats();
    }

    // ---------- CARD INTERACTION ----------
    card.addEventListener('click', function() {
      this.classList.add('flipping');
      setTimeout(() => {
        const categories = Object.keys(QUOTE_CATEGORIES);
        const randomCategory = categories[rand(0, categories.length - 1)];
        state.currentCategory = randomCategory;
        renderQuoteCategories();
        generateRandomQuote(randomCategory);
        this.classList.remove('flipping');
      }, 500);
    });

    // ---------- EXPORT AND GALLERY ----------
    function toPNG(){ return card.toDataURL('image/png'); }
    
    dlBtn.addEventListener('click', ()=>{
      const link = document.createElement('a');
      const name = (nameInput.value||'MemeLord').replace(/[^a-z0-9_-]+/gi,'_');
      link.download = `${name}_card.png`;
      link.href = toPNG(); 
      link.click();
      addToGallery();
      showNotification('Card downloaded successfully!');
      dlBtn.style.animation = 'pulse 0.6s ease';
      setTimeout(() => dlBtn.style.animation = '', 600);
    });

    async function share(){
      try{
        const blob = await (await fetch(toPNG())).blob();
        const file = new File([blob], 'meme-lord.png', {type:'image/png'});
        if(navigator.canShare && navigator.canShare({files:[file]})){
          await navigator.share({ title:'Meme Lord Card', files:[file], text:'Check my Meme Lord card!' });
          showNotification('Card shared successfully!');
        } else {
          showNotification('Share failed. Please download instead.');
          dlBtn.click();
        }
      }catch(e){ 
        console.error(e); 
        showNotification('Share failed. Please download instead.'); 
      }
    }
    shareBtn.addEventListener('click', share);

    // Add card to Firestore and gallery
    async function addToGallery(){
      if (!db || !userId) {
        console.error("Firebase is not initialized.");
        showNotification("Database not ready. Cards will not be saved.");
        return;
      }
      
      const cardData = {
        name: nameInput.value,
        rarity: rarity.value,
        lvl: +lvl.value,
        vir: +vir.value,
        chs: +chs.value,
        quote: state.quote,
        themeId: state.theme.id,
        imageUrl: toPNG(), // Saving the image as a base64 URL
        timestamp: Date.now()
      };
      
      try {
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const galleryPath = `/artifacts/${appId}/users/${userId}/gallery`;
        await addDoc(collection(db, galleryPath), cardData);
        showNotification("Card saved to gallery!");
      } catch (e) {
        console.error("Error saving to Firestore:", e);
        showNotification("Failed to save card. Check permissions.");
      }
    }

    // Load gallery from Firestore
    function loadGallery(){
      if (!db || !userId) return;

      loader.style.display = 'block';
      gallery.innerHTML = '';
      const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
      const galleryPath = `/artifacts/${appId}/users/${userId}/gallery`;
      const q = collection(db, galleryPath);

      onSnapshot(q, (querySnapshot) => {
        loader.style.display = 'none';
        gallery.innerHTML = ''; // Clear gallery before rendering
        querySnapshot.forEach((doc) => {
          const cardData = doc.data();
          renderGalleryItem(cardData, doc.id);
        });
      }, (error) => {
        console.error("Error fetching from Firestore:", error);
        loader.style.display = 'none';
        showNotification("Failed to load gallery. Try refreshing the page.");
      });
    }

    function renderGalleryItem(data, docId){
      const img = new Image(); 
      img.src = data.imageUrl;
      const wrap = document.createElement('div'); 
      wrap.className='thumb';
      wrap.style.animationDelay = '0s';
      const a = document.createElement('a'); 
      a.href = img.src; 
      a.download = `${data.name}_card.png`;
      a.appendChild(img); 
      wrap.appendChild(a); 
      gallery.prepend(wrap);
      
      setTimeout(() => wrap.style.animation = 'fadeInUp 0.6s ease-out', 10);
    }
    
    // ---------- EVENT HANDLERS ----------
    randomBtn.addEventListener('click', randomize);
    
    quoteBtn.addEventListener('click', ()=>{ 
      generateRandomQuote();
      quoteBtn.style.animation = 'bounce 0.6s ease';
      setTimeout(() => quoteBtn.style.animation = '', 600);
    });
    
    genBtn.addEventListener('click', () => {
      drawCard();
      showNotification('Card created!');
      genBtn.style.animation = 'pulse 0.4s ease';
      setTimeout(() => genBtn.style.animation = '', 400);
    });

    [nameInput, rarity, lvl, vir, chs].forEach(input => {
      input.addEventListener('input', () => {
        drawCard();
        input.style.animation = 'pulse 0.3s ease';
        setTimeout(() => input.style.animation = '', 300);
      });
    });

    nameInput.addEventListener('input', drawCard);
    rarity.addEventListener('change', drawCard);
    lvl.addEventListener('input', drawCard);
    vir.addEventListener('input', drawCard);
    chs.addEventListener('input', drawCard);

    // Automatic quote generation
    setInterval(() => {
      if (!state.imageBitmap) {
        const categories = Object.keys(QUOTE_CATEGORIES);
        state.currentCategory = categories[rand(0, categories.length-1)];
        renderQuoteCategories();
        generateRandomQuote();
      }
    }, 45000);

    // Welcome notification
    setTimeout(() => {
      showNotification('Welcome! Upload an image or click the card to start 🎉');
    }, 2000);

    // Initial render
    drawCard();
    renderQuoteCategories();
    renderThemeChips();
  })();
</script>
</body>
</html>
